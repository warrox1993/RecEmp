<div [class.app-container]="!isHomePage">

  <mat-toolbar color="primary" class="app-header" *ngIf="!isHomePage">
    <span class="app-title" routerLink="/">{{ title }}</span>
    <span class="spacer"></span>

    <div class="header-right-content">
      <div class="nav-links-group" *ngIf="isAuthenticated() && currentUser()">
        <a mat-button routerLink="/dashboard">
          <mat-icon>dashboard</mat-icon>
          <span>Tableau de Bord</span>
        </a>
        <a mat-button routerLink="/candidatures">
          <mat-icon>list_alt</mat-icon>
          <span>Mes Candidatures</span>
        </a>
        <a mat-button routerLink="/reminders">
          <mat-icon>checklist_rtl</mat-icon>
          <span>Mes Rappels</span>
        </a>
      </div>

      <mat-divider vertical class="header-divider"
                   *ngIf="isAuthenticated() && currentUser() && notifications().length > 0"></mat-divider>

      <div class="user-actions-group">
        <ng-container *ngIf="!isAuthenticated()">
          <a mat-button routerLink="/login">
            <mat-icon>login</mat-icon>
            Connexion
          </a>
          <a mat-button routerLink="/register">
            <mat-icon>person_add</mat-icon>
            Inscription
          </a>
        </ng-container>

        <ng-container *ngIf="isAuthenticated() && currentUser() as user">
          <button mat-icon-button [matMenuTriggerFor]="notificationsMenu"
                  aria-label="Ouvrir le menu des notifications" class="notifications-button">
            <mat-icon [matBadge]="unreadNotificationsCount()" matBadgeColor="warn"
                      [matBadgeHidden]="unreadNotificationsCount() === 0">notifications
            </mat-icon>
          </button>
          <mat-menu #notificationsMenu="matMenu" class="notifications-panel">
            <div class="notifications-header">
              <h3>Notifications</h3>
              <button mat-stroked-button *ngIf="unreadNotificationsCount() > 0"
                      (click)="markAllNotificationsAsRead()" class="mark-all-read-button">
                Tout marquer comme lu
              </button>
            </div>
            <mat-divider></mat-divider>
            <div class="notifications-list-container">
              <mat-list *ngIf="notifications().length > 0; else noNotificationsTemplate">
                <mat-list-item *ngFor="let notif of notifications().slice(0, 5)"
                               [class.unread]="!notif.isRead"
                               (click)="onNotificationClick(notif)"
                               class="notification-item"
                               [attr.aria-label]="'Notification: ' + notif.title + (notif.isRead ? '' : ' (non lue)')">
                  <mat-icon matListItemIcon [ngClass]="notif.type" aria-hidden="true">{{ getNotificationIcon(notif.type) }}</mat-icon>
                  <div matListItemTitle class="notification-title">{{ notif.title }}</div>
                  <div matListItemLine class="notification-message">{{ notif.message }}</div>
                  <div matListItemMeta class="notification-date">{{ notif.date | date:'shortTime' }}</div>
                </mat-list-item>
                <mat-list-item *ngIf="notifications().length > 5" routerLink="/notifications" class="view-all-notifications">
                  <mat-icon matListItemIcon>read_more</mat-icon>
                  <div matListItemTitle>Voir toutes les notifications</div>
                </mat-list-item>
              </mat-list>
              <ng-template #noNotificationsTemplate>
                <div class="no-notifications-message">
                  <mat-icon>notifications_off</mat-icon>
                  <p>Aucune nouvelle notification</p>
                </div>
              </ng-template>
            </div>
          </mat-menu>

          <button mat-icon-button [matMenuTriggerFor]="userMenu" aria-label="Ouvrir le menu utilisateur">
            <mat-icon>account_circle</mat-icon>
            <span *ngIf="user.firstName" class="user-name-display">{{ user.firstName }}</span>
          </button>
          <mat-menu #userMenu="matMenu">
            <button mat-menu-item routerLink="/profil">
              <mat-icon>manage_accounts</mat-icon>
              <span>Mon Profil</span>
            </button>
            <button mat-menu-item (click)="logout()">
              <mat-icon>logout</mat-icon>
              <span>Déconnexion</span>
            </button>
          </mat-menu>
        </ng-container>
      </div>
    </div>
  </mat-toolbar>

  <main [class.app-content]="!isHomePage">
    <router-outlet></router-outlet>
  </main>

  <footer class="app-footer" *ngIf="!isHomePage">
    <p>&copy; {{ currentYear }} {{ title }}. Tous droits réservés.</p>

    <nav aria-label="Liens de pied de page">
      <a routerLink="/mentions-legales">Mentions Légales</a> |
      <a routerLink="/confidentialite">Confidentialité</a>
    </nav>
    
  </footer>

</div>
